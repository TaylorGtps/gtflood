void save_all() {
    // WAJIB: hentikan lebih awal kalau ENet host belum ada
    if (server == nullptr) {
        std::cout << "[SAFE EXIT] server masih nullptr, save_all() dibatalkan agar tidak crash.\n";
        return;
    }

    // Optional: jika peers array sendiri bermasalah
    if (server->peers == nullptr || server->peerCount == 0) {
        std::cout << "[SAFE EXIT] peers kosong, skip save player.\n";
    } else {
        for (ENetPeer* currentPeer = server->peers;
             currentPeer < &server->peers[server->peerCount];
             ++currentPeer) {

            if (currentPeer == nullptr) continue;
            if (currentPeer->state != ENET_PEER_STATE_CONNECTED || currentPeer->data == nullptr) continue;

            try {
                save_player(pInfo(currentPeer), false);
            } catch (...) {
                std::cout << "[ERROR TERCEGAH] Crash saat save_player() diabaikan.\n";
            }
        }
    }

    // Save world tetap di isolate biar 1 world corrupt tidak crash
    for (size_t i = 0; i < worlds.size(); i++) {
        try {
            save_world(worlds[i].name, false);
        } catch (...) {
            std::cout << "[ERROR TERCEGAH] Crash saat save_world() diabaikan di index " << i << "\n";
        }
    }

    try {
        save_guilds();
        save_guilds();
    } catch (...) {
        std::cout << "[ERROR TERCEGAH] Crash di save_guilds() diabaikan.\n";
    }

    try {
        save_guilds();
    } catch (...) {
        std::cout << "[ERROR TERCEGAH] Crash di save_guilds() diabaikan.\n";
    }

    std::cout << "[DONE] save_all() selesai tanpa crash.\n";
    Sleep(1000);
}
